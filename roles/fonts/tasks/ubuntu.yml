---
- name: "Fonts | Update APT cache"
  ansible.builtin.apt:
    update_cache: true
  become: true
  changed_when: false

- name: "Fonts | Install fontconfig and emoji support"
  ansible.builtin.apt:
    name:
      - fontconfig
      - fonts-noto-color-emoji
    state: present
  become: true

- name: "Fonts | Download nerd-fonts"
  ansible.builtin.get_url:
    url: https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip
    dest: "{{ ansible_user_dir }}/Meslo.zip"
  notify:
    - "Fonts | Cleanup downloaded zip file"

- name: "Fonts | Create fonts directory"
  ansible.builtin.file:
    path: "{{ ansible_user_dir }}/.local/share/fonts"
    state: directory
    mode: "0755"

- name: "Fonts | Unzip nerd-fonts"
  ansible.builtin.unarchive:
    src: "{{ ansible_user_dir }}/Meslo.zip"
    dest: "{{ ansible_user_dir }}/.local/share/fonts"
    remote_src: true

- name: "Fonts | Ensure config directories exist"
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  loop:
    - "{{ ansible_user_dir }}/.config/fontconfig"
    - "{{ ansible_user_dir }}/.config/fontconfig/conf.d"

- name: "fonts | Create symlink to fontconfig config"
  ansible.builtin.file:
    src: "{{ role_path }}/files/fonts.conf"
    dest: "{{ ansible_user_dir }}/.config/fontconfig/fonts.conf"
    state: link
    force: true
  become: true

- name: "fonts | Create symlink to emoji fontconfig config"
  ansible.builtin.file:
    src: "{{ role_path }}/files/01-emoji.conf"
    dest: "{{ ansible_user_dir }}/.config/fontconfig/conf.d/01-emoji.conf"
    state: link
    force: true
  become: true

- name: "Fonts | Update font cache"
  ansible.builtin.shell: "fc-cache -fv"
  changed_when: false
